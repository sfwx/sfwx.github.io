<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FwX | Editor de Item</title>
    <link rel="stylesheet" href="https://sfwx.github.io/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { overflow-y: auto; padding: 40px 0; }
        .glass-card { max-width: 650px; text-align: left; margin: auto; }
        
        .form-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 15px; 
            margin-top: 20px; 
        }

        .full-width { grid-column: span 2; }

        label { 
            display: block; 
            font-size: 0.75rem; 
            color: var(--accent); 
            text-transform: uppercase; 
            font-weight: 600;
            margin-bottom: 5px;
            letter-spacing: 1px;
        }

        input, textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px;
            color: #fff;
            font-family: 'Inter', sans-serif;
            outline: none;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus { border-color: var(--accent); }
        textarea { height: 80px; resize: vertical; }

        /* Destaque para o Input de JSON */
        #rawJsonInput {
            background: rgba(0, 0, 0, 0.3);
            font-family: monospace;
            font-size: 0.8rem;
            border-style: dashed;
        }

        .table-container {
            margin-top: 30px;
            max-height: 300px;
            overflow-y: auto;
            border-radius: 12px;
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border);
        }

        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th { position: sticky; top: 0; background: #1e1b4b; color: var(--accent); padding: 10px; text-align: left; }
        td { padding: 8px 10px; border-bottom: 1px solid var(--border); color: #94a3b8; }
        tr:hover td { color: #fff; background: rgba(255,255,255,0.02); }

        .btn-apply {
            width: 100%;
            background: var(--accent);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-weight: 800;
            cursor: pointer;
            margin-top: 25px;
            transition: transform 0.2s, box-shadow 0.2s;
            text-transform: uppercase;
        }

        .btn-load {
            background: #334155;
            margin-top: 10px;
            padding: 8px;
            font-size: 0.7rem;
        }

        .btn-apply:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px var(--accent-glow);
        }
    </style>
</head>
<body>

    <div class="bg-gradient"></div>
    <div class="bg-glow"></div>

    <main class="glass-card">
        <header style="text-align: center; margin-bottom: 30px;">
            <img src="https://sfwx.github.io/index0.png" alt="Icon" class="brand-icon" style="width: 60px; height: 60px;">
            <span class="nickname" style="display: block;">FwX Editor</span>
            <h1>Editor Rápido de Item</h1>
        </header>

        <div class="full-width">
            <label>1. Cole o JSON Completo aqui</label>
            <textarea id="rawJsonInput" placeholder='Cole o conteúdo do seu arquivo de item json aqui...'></textarea>
            <button class="btn-apply btn-load" onclick="carregarDados()">Carregar dados para o editor</button>
        </div>

        <hr style="border: 0; border-top: 1px solid var(--border); margin: 30px 0;">

        <div class="form-grid">
            <div>
                <label>Quantidade</label>
                <input id="count" type="number">
            </div>
            <div>
                <label>Item (ID)</label>
                <input id="itemId" placeholder="minecraft:sword">
            </div>
            <div class="full-width">
                <label>Nome (Display)</label>
                <input id="displayName">
            </div>
            <div class="full-width">
                <label>Descrição (Lore linha 1)</label>
                <textarea id="lore"></textarea>
            </div>
            <div class="full-width">
                <label>Encantamentos (JSON bruto)</label>
                <textarea id="ench" placeholder='[{"id":17,"lvl":3}]'></textarea>
            </div>
            <div>
                <label>Inquebrável (0/1)</label>
                <input id="unbreakable" type="number">
            </div>
            <div>
                <label>Tag</label>
                <input id="tag">
            </div>
            <div class="full-width">
                <label>Custom Name</label>
                <input id="customName">
            </div>
        </div>

        <button class="btn-apply" onclick="aplicar()">2. Aplicar e Baixar JSON Editado</button>

        <div class="table-container">
            <table>
                <thead>
                    <tr><th>ID</th><th>Encantamento</th><th>Aplicação</th></tr>
                </thead>
                <tbody id="table-body"></tbody>
            </table>
        </div>

        <footer class="footer-copyright" style="text-align: center;">
            © <span id="year"></span> FlowniX. Sistema Interno.<br>
            <a href="https://sfwx.github.io/copyright">Direitos Autorais</a>
        </footer>
    </main>

    <script>
        document.getElementById('year').textContent = new Date().getFullYear();
        let currentItemData = null; // Armazena o objeto JSON carregado

        // Popular tabela
        const enchantData = [[0,"Proteção","Armaduras"],[1,"Proteção Contra Fogo","Armaduras"],[2,"Queda Suave","Botas"],[3,"Proteção Contra Explosões","Armaduras"],[4,"Proteção Contra Projéteis","Armaduras"],[5,"Espinhos","Armaduras"],[6,"Respiração","Capacete"],[7,"Passos Profundos","Botas"],[8,"Afinidade Aquática","Capacete"],[9,"Afiação","Espadas/Machados"],[10,"Ruína dos Mortos-Vivos","Espadas/Machados"],[11,"Perdição dos Artrópodes","Espadas/Machados"],[12,"Impacto","Espadas"],[13,"Aspecto Flamejante","Espadas"],[14,"Saque","Espadas"],[15,"Eficiência","Ferramentas"],[16,"Toque Suave","Ferramentas"],[17,"Inquebrável","Todos"],[18,"Fortuna","Ferramentas"],[19,"Força","Arcos"],[20,"Repulsão","Arcos"],[21,"Chama","Arcos"],[22,"Infinidade","Arcos"],[23,"Sorte do Mar","Varas"],[24,"Isca","Varas"],[25,"Passos Gelados","Botas"],[26,"Remendo","Todos"],[27,"Maldição da Ligação","Armaduras"],[28,"Maldição do Desaparecimento","Todos"],[29,"Empalamento","Tridentes"],[30,"Propulsão","Tridentes"],[31,"Lealdade","Tridentes"],[32,"Condutividade","Tridentes"],[33,"Tiro Múltiplo","Bestas"],[34,"Perfuração","Bestas"],[35,"Carga Rápida","Bestas"],[36,"Passos das Almas","Botas"],[37,"Passos Sorrateiros","Calças"],[38,"Investida","Lanças"]];
        document.getElementById('table-body').innerHTML = enchantData.map(row => `<tr><td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td></tr>`).join('');

        function garantir(obj, path, valorFinal) {
            let ref = obj;
            for (let i = 0; i < path.length; i++) {
                if (ref[path[i]] === undefined) {
                    ref[path[i]] = (i === path.length - 1) ? valorFinal : {};
                }
                ref = ref[path[i]];
            }
            return ref;
        }

        // FUNÇÃO PARA CARREGAR O JSON DO TEXTAREA
        function carregarDados() {
            const input = document.getElementById('rawJsonInput').value;
            try {
                currentItemData = JSON.parse(input);
                const entity = currentItemData.value.structure.value.entities.value.value[0];

                document.getElementById('count').value = entity.Item?.value?.Count?.value ?? 1;
                document.getElementById('itemId').value = entity.Item?.value?.Name?.value ?? "";
                document.getElementById('displayName').value = entity.Item?.value?.tag?.value?.display?.value?.Name?.value ?? "";
                document.getElementById('lore').value = entity.Item?.value?.tag?.value?.display?.value?.Lore?.value?.value?.[0] ?? "";
                document.getElementById('ench').value = JSON.stringify(entity.Item?.value?.tag?.value?.ench?.value?.value ?? [], null, 0);
                document.getElementById('unbreakable').value = entity.Item?.value?.tag?.value?.Unbreakable?.value ?? 0;
                document.getElementById('tag').value = entity.Tags?.value?.value?.[0] ?? "";
                document.getElementById('customName').value = entity.CustomName?.value ?? "";
            } catch (e) {
                alert("Erro ao ler JSON: Certifique-se de que o texto colado é um JSON válido.");
            }
        }

        function aplicar() {
            if (!currentItemData) {
                alert("Por favor, carregue um JSON primeiro!");
                return;
            }

            const entity = currentItemData.value.structure.value.entities.value.value[0];

            garantir(entity, ["Item","value","Count"], { value: 1 }).value = Number(document.getElementById('count').value);
            garantir(entity, ["Item","value","Name"], { value: "" }).value = document.getElementById('itemId').value;
            garantir(entity, ["Item","value","tag","value","display","value","Name"], { value: "" }).value = document.getElementById('displayName').value;
            garantir(entity, ["Item","value","tag","value","display","value","Lore","value","value"], []).splice(0, 1, document.getElementById('lore').value);
            
            try {
                garantir(entity, ["Item","value","tag","value","ench","value","value"], []).splice(0, Infinity, ...JSON.parse(document.getElementById('ench').value || "[]"));
            } catch(e) { alert("Erro no campo Encantamentos. Use formato JSON."); return; }

            garantir(entity, ["Item","value","tag","value","Unbreakable"], { value: 0 }).value = Number(document.getElementById('unbreakable').value);
            garantir(entity, ["Tags","value","value"], []).splice(0, 1, document.getElementById('tag').value);
            garantir(entity, ["CustomName"], { value: "" }).value = document.getElementById('customName').value;

            const bruto = JSON.stringify(currentItemData);
            const blob = new Blob([bruto], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = document.getElementById('itemId').value.replace("minecraft:", "") + ".json";
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>